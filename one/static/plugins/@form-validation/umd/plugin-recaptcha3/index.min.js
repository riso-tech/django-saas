/**
 * FormValidation (https://formvalidation.io)
 * The best validation library for JavaScript
 * (c) 2013 - 2023 Nguyen Huu Phuoc <me@phuoc.ng>
 *
 * @license https://formvalidation.io/license
 * @package @form-validation/plugin-recaptcha3
 * @version 2.0.2
 */

!(function (t, e) {
  'object' == typeof exports && 'undefined' != typeof module
    ? (module.exports = e(require('@form-validation/core')))
    : 'function' == typeof define && define.amd
      ? define(['@form-validation/core'], e)
      : (((t =
          'undefined' != typeof globalThis
            ? globalThis
            : t || self).FormValidation = t.FormValidation || {}),
        (t.FormValidation.plugins = t.FormValidation.plugins || {}),
        (t.FormValidation.plugins.Recaptcha3 = e(t.FormValidation)));
})(this, function (t) {
  'use strict';
  var e = function (t, o) {
    return (
      (e =
        Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array &&
          function (t, e) {
            t.__proto__ = e;
          }) ||
        function (t, e) {
          for (var o in e)
            Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }),
      e(t, o)
    );
  };
  var o = t.utils.fetch;
  return (function (t) {
    function n(e) {
      var o = t.call(this, e) || this;
      return (
        (o.opts = Object.assign({}, { minimumScore: 0 }, e)),
        (o.iconPlacedHandler = o.onIconPlaced.bind(o)),
        o
      );
    }
    return (
      (function (t, o) {
        if ('function' != typeof o && null !== o)
          throw new TypeError(
            'Class extends value ' +
              String(o) +
              ' is not a constructor or null',
          );
        function n() {
          this.constructor = t;
        }
        e(t, o),
          (t.prototype =
            null === o
              ? Object.create(o)
              : ((n.prototype = o.prototype), new n()));
      })(n, t),
      (n.prototype.install = function () {
        var t = this;
        this.core.on('plugins.icon.placed', this.iconPlacedHandler);
        var e =
          void 0 === window[n.LOADED_CALLBACK]
            ? function () {}
            : window[n.LOADED_CALLBACK];
        window[n.LOADED_CALLBACK] = function () {
          e();
          var i = document.createElement('input');
          i.setAttribute('type', 'hidden'),
            i.setAttribute('name', n.CAPTCHA_FIELD),
            document.getElementById(t.opts.element).appendChild(i),
            t.core.addField(n.CAPTCHA_FIELD, {
              validators: {
                promise: {
                  message: t.opts.message,
                  promise: function (e) {
                    return new Promise(function (e, i) {
                      window.grecaptcha
                        .execute(t.opts.siteKey, { action: t.opts.action })
                        .then(function (c) {
                          var r;
                          o(t.opts.backendVerificationUrl, {
                            method: 'POST',
                            params: ((r = {}), (r[n.CAPTCHA_FIELD] = c), r),
                          })
                            .then(function (o) {
                              var n =
                                'true' === ''.concat(o.success) &&
                                o.score >= t.opts.minimumScore;
                              e({
                                message: o.message || t.opts.message,
                                meta: o,
                                valid: n,
                              });
                            })
                            .catch(function (t) {
                              i({ valid: !1 });
                            });
                        });
                    });
                  },
                },
              },
            });
        };
        var i = this.getScript();
        if (!document.body.querySelector('script[src="'.concat(i, '"]'))) {
          var c = document.createElement('script');
          (c.type = 'text/javascript'),
            (c.async = !0),
            (c.defer = !0),
            (c.src = i),
            document.body.appendChild(c);
        }
      }),
      (n.prototype.uninstall = function () {
        delete window[n.LOADED_CALLBACK],
          this.core.off('plugins.icon.placed', this.iconPlacedHandler);
        var t = this.getScript();
        [].slice
          .call(document.body.querySelectorAll('script[src="'.concat(t, '"]')))
          .forEach(function (t) {
            return t.parentNode.removeChild(t);
          }),
          this.core.removeField(n.CAPTCHA_FIELD);
      }),
      (n.prototype.getScript = function () {
        var t = this.opts.language ? '&hl='.concat(this.opts.language) : '';
        return (
          'https://www.google.com/recaptcha/api.js?' +
          'onload='
            .concat(n.LOADED_CALLBACK, '&render=')
            .concat(this.opts.siteKey)
            .concat(t)
        );
      }),
      (n.prototype.onIconPlaced = function (t) {
        t.field === n.CAPTCHA_FIELD && (t.iconElement.style.display = 'none');
      }),
      (n.CAPTCHA_FIELD = '___g-recaptcha-token___'),
      (n.LOADED_CALLBACK = '___reCaptcha3Loaded___'),
      n
    );
  })(t.Plugin);
});
